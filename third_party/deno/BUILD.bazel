load("@toolchain_utils//toolchain/info:defs.bzl", "toolchain_info")
load("@toolchain_utils//toolchain/test:defs.bzl", "toolchain_test")

toolchain_type(
    name = "toolchain_type",
    visibility = ["//visibility:public"],
)

supported_platforms = [
    ("deno_x86_64_unknown_linux_gnu", "linux", "x86_64"),
    ("deno_aarch64_unknown_linux_gnu", "linux", "aarch64"),
    ("deno_aarch64_apple_darwin", "macos", "aarch64"),
    ("deno_x86_64_pc_windows_msvc", "windows", "x86_64"),
]

[
    [
        toolchain_info(
            name = target,
            target = "@" + target,
            variable = "DENO",
        ),
        toolchain(
            name = target + "_toolchain",
            exec_compatible_with = [
                "@platforms//cpu:" + cpu,
                "@platforms//os:" + os,
            ],
            toolchain = ":" + target,
            toolchain_type = ":toolchain_type",
        ),
    ]
    for target, os, cpu in supported_platforms
]

alias(
    name = "resolved",
    actual = "@resolved-deno",
    visibility = ["//visibility:public"],
)

toolchain_test(
    name = "test",
    args = ["--version"],
    tags = ["windows"],
    toolchains = [":resolved"],
)
