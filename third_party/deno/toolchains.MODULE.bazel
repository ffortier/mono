http_archive = use_repo_rule("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")

BUILD_FILE_CONTENT = """
filegroup(
    name = "{repo_name}",
    srcs = ["{deno}"],
    visibility = ["//visibility:public"],
)
"""

http_archive(
    name = "deno_darwin_aarch64",
    urls = ["https://github.com/denoland/deno/releases/download/v2.6.1/deno-aarch64-apple-darwin.zip"],
    sha256 = "6668f50508b42fad9ce2dff6912bfaaf7c1a3b23a11e95e9cc7f5647f1cf614e",
    build_file_content = BUILD_FILE_CONTENT.format(repo_name = "deno_darwin_aarch64", deno = "deno"),
)

http_archive(
    name = "deno_linux_x86_64",
    urls = ["https://github.com/denoland/deno/releases/download/v2.6.1/deno-x86_64-unknown-linux-gnu.zip"],
    sha256 = "9e1c284e0440ac27f1933aa98edcfe0ef3d1ae7c8f755d67682d182a7d1afc0f",
    build_file_content = BUILD_FILE_CONTENT.format(repo_name = "deno_linux_x86_64", deno = "deno"),
)

http_archive(
    name = "deno_linux_aarch64",
    urls = ["https://github.com/denoland/deno/releases/download/v2.6.1/deno-aarch64-unknown-linux-gnu.zip"],
    sha256 = "ac1cf4f44f78495b21ee6655a4a3b99b3bebc3c86cd9eb5aab5e3bdda2391ecd",
    build_file_content = BUILD_FILE_CONTENT.format(repo_name = "deno_linux_aarch64", deno = "deno"),
)

http_archive(
    name = "deno_windows_x86_64",
    urls = ["https://github.com/denoland/deno/releases/download/v2.6.1/deno-x86_64-pc-windows-msvc.zip"],
    sha256 = "7faf4df82efb9b3cee094cfb3437dc797cc992c0e9dfb2433e7431abee513518",
    build_file_content = BUILD_FILE_CONTENT.format(repo_name = "deno_windows_x86_64", deno = "deno.exe"),
)

register_toolchains("//third_party/deno:all")

resolved = use_repo_rule("@toolchain_utils//toolchain/resolved:defs.bzl", "toolchain_resolved")

resolved(
    name = "resolved-deno",
    toolchain_type = "//third_party/deno:toolchain_type",
)

deno = use_extension("//third_party/deno:extension.bzl", "deno")

deno.install(
    lock = "//:deno.lock",
    config = "//:deno.jsonc",
)

use_repo(deno, "deno")
